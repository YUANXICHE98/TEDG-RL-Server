# V4 å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸ¯ ç›®æ ‡

éªŒè¯V4çš„Cross-Attentionæœºåˆ¶æ˜¯å¦ä¼˜äºV3çš„Concatèåˆã€‚

## ğŸ“‹ æ­¥éª¤

### 1. çƒŸé›¾æµ‹è¯• (1åˆ†é’Ÿ)

éªŒè¯V4å®ç°æ­£ç¡®æ€§ï¼š

```bash
python ablation_v4/test_v4_smoke.py
```

**é¢„æœŸè¾“å‡º**: 7ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡ âœ“

---

### 2. å°è§„æ¨¡å¯¹æ¯”æµ‹è¯• (çº¦30åˆ†é’Ÿ)

å¿«é€ŸéªŒè¯V4ç›¸å¯¹V3çš„æ”¹è¿›ï¼š

```bash
bash ablation_v4/scripts/run_v3_v4_comparison_100ep.sh
```

**è¿™ä¸ªè„šæœ¬ä¼š**:
1. ä½¿ç”¨V3å·²æœ‰çš„warmup_1000ç»“æœï¼ˆå‰100 episodesï¼‰ä½œä¸ºåŸºå‡†
2. è¿è¡ŒV4è®­ç»ƒ100 episodes
3. ç”Ÿæˆå¯¹æ¯”åˆ†ææŠ¥å‘Šå’Œå¯è§†åŒ–

**æŸ¥çœ‹ç»“æœ**:
```bash
# æŸ¥çœ‹å¯¹æ¯”å›¾
open ablation_v4/results/v3_v4_comparison_100ep.png
```

**å…³é”®æŒ‡æ ‡**:
- âœ… Episode Rewards/Scores: V4åº”è¯¥æ›´é«˜
- âœ… Alpha Entropy: V4åº”è¯¥æ›´ä½ï¼ˆæ›´å¥½çš„ä¸“å®¶ä¸“ä¸šåŒ–ï¼‰
- âœ… Expert Usage Variance: V4åº”è¯¥æ›´é«˜ï¼ˆæ›´å¥½çš„ä¸“å®¶å·®å¼‚åŒ–ï¼‰

---

### 3. å®Œæ•´è®­ç»ƒ (å¦‚æœå°è§„æ¨¡æµ‹è¯•æ•ˆæœå¥½)

```bash
# Warmupé˜¶æ®µ (0-1000 episodes)
bash ablation_v4/scripts/run_warmup_1000.sh

# Transitioné˜¶æ®µ (1000-3000 episodes)
bash ablation_v4/scripts/run_transition_3000.sh

# Fine-tuneé˜¶æ®µ (3000-5000 episodes)
bash ablation_v4/scripts/run_finetune_5000.sh
```

---

## ğŸ” å¯¹æ¯”åˆ†æ

### V3 vs V4 æ ¸å¿ƒå·®å¼‚

| ç»„ä»¶ | V3 | V4 |
|------|----|----|
| **èåˆæ–¹å¼** | Concat | Cross-Attention |
| **èåˆè¾“å‡º** | 512-dim | 256-dim Context Vector |
| **æ¨¡æ€äº¤äº’** | æ—  | Query-Keyæœºåˆ¶ |
| **ç‰¹å¾é€‰æ‹©** | å…¨éƒ¨ | Sparse Gate (top-30%) |

### é¢„æœŸæ”¹è¿›

| æŒ‡æ ‡ | V3 | V4 (é¢„æœŸ) |
|------|----|-----------| 
| **Alphaç†µ** | 0.693 (å¡åœ¨ln2) | 0.3-0.5 |
| **å¹³å‡åˆ†æ•°** | 10.68 | 15-20 |
| **ä¸“å®¶ä½¿ç”¨** | åªç”¨2ä¸ª | ä½¿ç”¨å…¨éƒ¨4ä¸ª |

---

## ğŸ“Š ç»“æœè§£è¯»

### å¦‚æœV4æ•ˆæœå¥½

âœ… **ç»§ç»­å®Œæ•´è®­ç»ƒ**
- Cross-Attentionæœºåˆ¶æœ‰æ•ˆ
- å¯ä»¥ç¼“è§£æ¨¡æ€ä¸»å¯¼é—®é¢˜
- å€¼å¾—è¿›ä¸€æ­¥ä¼˜åŒ–

### å¦‚æœV4æ•ˆæœä¸æ˜æ˜¾

âš ï¸ **éœ€è¦è°ƒæ•´**
- è°ƒæ•´Sparse Gateé˜ˆå€¼ (30% â†’ 50%)
- è°ƒæ•´Attention Headæ•°é‡ (4 â†’ 8)
- è°ƒæ•´Context Vectorç»´åº¦ (256 â†’ 384)
- æ£€æŸ¥æ˜¯å¦éœ€è¦æ›´å¼ºçš„Managerçº¦æŸ

---

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### è®­ç»ƒå¤±è´¥

```bash
# æ£€æŸ¥ç¯å¢ƒ
conda activate tedg-rl-demo
python -c "import torch; print(torch.__version__)"

# æ£€æŸ¥æ•°æ®
ls data/hypergraph/hypergraph_gat_structure.json
```

### NaN/Infé”™è¯¯

- æ£€æŸ¥å­¦ä¹ ç‡æ˜¯å¦è¿‡å¤§
- æ£€æŸ¥æ¢¯åº¦è£å‰ªæ˜¯å¦ç”Ÿæ•ˆ
- æŸ¥çœ‹è®­ç»ƒæ—¥å¿—ä¸­çš„NaNæ£€æµ‹ä¿¡æ¯

### æ€§èƒ½ä¸å¦‚é¢„æœŸ

- å¯¹æ¯”V3å’ŒV4çš„Alpha Entropyæ›²çº¿
- æ£€æŸ¥Expert Usage Variance
- æŸ¥çœ‹Attentionæƒé‡åˆ†å¸ƒ

---

## ğŸ“ ä¸‹ä¸€æ­¥

1. âœ… è¿è¡ŒçƒŸé›¾æµ‹è¯•
2. âœ… è¿è¡Œå°è§„æ¨¡å¯¹æ¯”æµ‹è¯•
3. â³ åˆ†æç»“æœï¼Œå†³å®šæ˜¯å¦ç»§ç»­å®Œæ•´è®­ç»ƒ
4. â³ å¦‚æœæ•ˆæœå¥½ï¼Œè¿è¡Œå®Œæ•´3é˜¶æ®µè®­ç»ƒ
5. â³ ä¸V3è¿›è¡Œå…¨é¢å¯¹æ¯”åˆ†æ

---

**åˆ›å»ºæ—¶é—´**: 2026-01-22  
**é¢„è®¡æ—¶é—´**: çƒŸé›¾æµ‹è¯•1åˆ†é’Ÿ + å°è§„æ¨¡æµ‹è¯•30åˆ†é’Ÿ = 31åˆ†é’Ÿ
