# ä¸“å®¶æ­£äº¤æ€§å¯è§†åŒ– - å¿«é€ŸæŒ‡å—

## ðŸŽ¯ ç›®æ ‡

ç”Ÿæˆä¸¤å¼ å›¾è¯æ˜Žä¸“å®¶çš„æ­£äº¤æ€§ï¼Œç”¨äºŽè®ºæ–‡ï¼š

1. **Expert Activation Heatmap** - æ—¶é—´æ­£äº¤æ€§ï¼ˆä¸åŒæ—¶åˆ»æ¿€æ´»ä¸åŒä¸“å®¶ï¼‰
2. **t-SNE Visualization** - å‚æ•°ç©ºé—´æ­£äº¤æ€§ï¼ˆä¸“å®¶æƒé‡åˆ†ç¦»ï¼‰

## ðŸ“ è¿è¡Œæ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šæå–æ•°æ®

```bash
python3 tools/extract_real_expert_data.py
```

**éœ€è¦çš„çŽ¯å¢ƒï¼š**
- PyTorch
- NLE (NetHack Learning Environment)
- è®­ç»ƒå¥½çš„checkpoint

**è¾“å‡ºï¼š**
- Alphaå€¼åŽ†å²ï¼ˆæ¯ä¸ªstepçš„ä¸“å®¶æ¿€æ´»ï¼‰
- ä¸“å®¶æƒé‡ï¼ˆ4ä¸ªä¸“å®¶çš„å‚æ•°ï¼‰

### ç¬¬äºŒæ­¥ï¼šç”Ÿæˆå›¾è¡¨

```bash
python3 tools/visualize_expert_orthogonality_real.py
```

**è¾“å‡ºï¼š**
- `expert_activation_heatmap_real.png` - çƒ­åŠ›å›¾
- `expert_weights_tsne_real.png` - t-SNEå›¾
- `expert_orthogonality_combined_real.png` - ç»„åˆå›¾ï¼ˆç”¨äºŽè®ºæ–‡ï¼‰

## ðŸ–¼ï¸ é¢„æœŸæ•ˆæžœ

### å›¾1ï¼šExpert Activation Heatmap

```
æ¨ªè½´ï¼šæ—¶é—´æ­¥ (0-1000)
çºµè½´ï¼šä¸“å®¶ç¼–å· (0-3)
é¢œè‰²ï¼šæ¿€æ´»å¼ºåº¦ (0-1ï¼Œçº¢è‰²=é«˜)

é¢„æœŸçœ‹åˆ°ï¼š
- å—çŠ¶åˆ†å¸ƒï¼ˆä¸æ˜¯å‡åŒ€åˆ†å¸ƒï¼‰
- ä¸åŒæ—¶é—´æ®µä¸åŒä¸“å®¶ä¸»å¯¼
- æ¸…æ™°çš„ä¸“å®¶åˆ‡æ¢ç‚¹
```

**ç¤ºä¾‹æ¨¡å¼ï¼š**
```
Expert 0: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  (å‰100æ­¥ä¸»å¯¼ - æˆ˜æ–—)
Expert 1: â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  (ä¸­é—´ä¸»å¯¼ - æŽ¢ç´¢)
Expert 2: â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  (åŽæœŸä¸»å¯¼ - ç‰©å“ç®¡ç†)
Expert 3: â–‘â–‘â–‘â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  (å¶å°”æ¿€æ´» - æ²»ç–—)
```

### å›¾2ï¼št-SNE Visualization

```
2Dæ•£ç‚¹å›¾ï¼Œæ¯ä¸ªç‚¹ä»£è¡¨ä¸€ä¸ªä¸“å®¶çš„æƒé‡

é¢„æœŸçœ‹åˆ°ï¼š
- 4ä¸ªæ¸…æ™°åˆ†ç¦»çš„cluster
- Clusterä¹‹é—´è·ç¦»è¿œ
- Clusterå†…éƒ¨ç´§å¯†

å…³é”®æŒ‡æ ‡ï¼š
- Separation Ratio > 2.0 = å¼ºæ­£äº¤æ€§
- Separation Ratio > 1.0 = ä¸­ç­‰æ­£äº¤æ€§
- Separation Ratio < 1.0 = å¼±æ­£äº¤æ€§
```

## ðŸš¨ å¦‚æžœæ²¡æœ‰PyTorchçŽ¯å¢ƒ

### æ–¹æ¡ˆ1ï¼šåœ¨è®­ç»ƒæœåŠ¡å™¨ä¸Šè¿è¡Œ

```bash
# 1. SSHåˆ°è®­ç»ƒæœåŠ¡å™¨
ssh your-server

# 2. æ¿€æ´»è®­ç»ƒçŽ¯å¢ƒ
conda activate rl-env

# 3. è¿è¡Œè„šæœ¬
cd /path/to/TEDG-RL-Server
python3 tools/extract_real_expert_data.py
python3 tools/visualize_expert_orthogonality_real.py

# 4. ä¸‹è½½å›¾ç‰‡
# åœ¨æœ¬åœ°è¿è¡Œï¼š
scp your-server:path/to/ablation_v3/visualizations/expert_orthogonality/*.png ./
```

### æ–¹æ¡ˆ2ï¼šå®‰è£…ä¾èµ–

```bash
pip install torch numpy matplotlib seaborn scikit-learn nle
```

## ðŸ“Š è®ºæ–‡ä¸­å¦‚ä½•ä½¿ç”¨

### Figureæ”¾ç½®

```latex
\begin{figure*}[t]
\centering
\includegraphics[width=0.9\textwidth]{expert_orthogonality_combined_real.png}
\caption{Expert Orthogonality Analysis...}
\label{fig:expert_orthogonality}
\end{figure*}
```

### Captionæ¨¡æ¿

```
Figure X: Expert Orthogonality Analysis. 
(a) Expert Activation Heatmap demonstrates temporal orthogonality: 
different experts are activated at different time steps, showing 
specialized behavior for different game scenarios (e.g., Expert 0 
for combat, Expert 3 for healing). 
(b) t-SNE visualization of expert weights demonstrates parameter 
space orthogonality: the four experts form well-separated clusters 
(separation ratio = X.XX), indicating distinct learned representations.
```

### æ­£æ–‡æè¿°

```
æˆ‘ä»¬é€šè¿‡ä¸¤ä¸ªåˆ†æžéªŒè¯ä¸“å®¶ç½‘ç»œçš„æ­£äº¤æ€§ï¼š

1. **æ—¶é—´æ­£äº¤æ€§**ï¼šå›¾X(a)æ˜¾ç¤ºäº†1000ä¸ªæ—¶é—´æ­¥çš„ä¸“å®¶æ¿€æ´»çƒ­åŠ›å›¾ã€‚
   æˆ‘ä»¬è§‚å¯Ÿåˆ°æ¸…æ™°çš„å—çŠ¶åˆ†å¸ƒï¼Œä¸åŒä¸“å®¶åœ¨ä¸åŒæ—¶åˆ»ä¸»å¯¼ã€‚ä¾‹å¦‚ï¼Œ
   Expert 0ä¸»è¦åœ¨æˆ˜æ–—åœºæ™¯æ¿€æ´»ï¼Œè€ŒExpert 3å¤„ç†æ²»ç–—å’Œæ¢å¤ã€‚
   è¿™è¯æ˜Žäº†ä¸“å®¶åœ¨ä¸åŒæ—¶é—´ä¸Šä¸‹æ–‡ä¸­çš„ä¸“ä¸šåŒ–ã€‚

2. **å‚æ•°ç©ºé—´æ­£äº¤æ€§**ï¼šå›¾X(b)æ˜¾ç¤ºäº†ä¸“å®¶æƒé‡çš„t-SNEå¯è§†åŒ–ã€‚
   å››ä¸ªä¸“å®¶å½¢æˆäº†æ¸…æ™°åˆ†ç¦»çš„clusterï¼Œå¹³å‡clusteré—´è·ç¦»ä¸ºX.XXï¼Œ
   åˆ†ç¦»æ¯”çŽ‡ä¸ºX.XXï¼Œè¡¨æ˜Žå¼ºæ­£äº¤æ€§ã€‚è¿™ç¡®è®¤äº†æ¯ä¸ªä¸“å®¶å­¦ä¹ åˆ°äº†
   ä¸åŒçš„è¡¨ç¤ºï¼Œè€Œä¸æ˜¯å†—ä½™ç‰¹å¾ã€‚
```

## ðŸ“ æ–‡ä»¶ä½ç½®

**å·¥å…·è„šæœ¬ï¼š**
- `tools/extract_real_expert_data.py` - æ•°æ®æå–
- `tools/visualize_expert_orthogonality_real.py` - å¯è§†åŒ–ç”Ÿæˆ

**è¾“å‡ºæ•°æ®ï¼š**
- `ablation_v3/visualizations/expert_data/` - æå–çš„æ•°æ®

**è¾“å‡ºå›¾è¡¨ï¼š**
- `ablation_v3/visualizations/expert_orthogonality/` - ç”Ÿæˆçš„å›¾è¡¨

## âœ… æ£€æŸ¥æ¸…å•

- [ ] ç¡®è®¤checkpointå­˜åœ¨ï¼š`ablation_v3/results/resume_500_from_100/checkpoints/checkpoint_500.pt`
- [ ] å®‰è£…äº†å¿…è¦çš„ä¾èµ–ï¼ˆtorch, nleç­‰ï¼‰
- [ ] è¿è¡Œæ•°æ®æå–è„šæœ¬
- [ ] è¿è¡Œå¯è§†åŒ–è„šæœ¬
- [ ] æ£€æŸ¥ç”Ÿæˆçš„å›¾è¡¨è´¨é‡
- [ ] å°†combined figureæ·»åŠ åˆ°è®ºæ–‡
- [ ] æ ¹æ®å®žé™…æ•°æ®æ›´æ–°captionä¸­çš„æ•°å€¼

## ðŸ”§ å¸¸è§é—®é¢˜

**Q: Checkpoint not found?**
```bash
# æ£€æŸ¥å¯ç”¨çš„checkpoints
ls ablation_v3/results/resume_500_from_100/checkpoints/
# ä¿®æ”¹è„šæœ¬ä¸­çš„è·¯å¾„
```

**Q: Out of memory?**
```python
# åœ¨extract_real_expert_data.pyä¸­å‡å°‘episodesæ•°é‡
num_episodes = 3  # ä»Ž5æ”¹ä¸º3
```

**Q: å›¾è¡¨ä¸æ¸…æ™°?**
```python
# åœ¨visualize_expert_orthogonality_real.pyä¸­è°ƒæ•´
max_steps = 1500  # å¢žåŠ æ˜¾ç¤ºçš„æ­¥æ•°
dpi = 300  # å·²ç»æ˜¯é«˜åˆ†è¾¨çŽ‡
```

---

**åˆ›å»ºæ—¶é—´**: 2026-01-13  
**çŠ¶æ€**: âœ… å·¥å…·å·²åˆ›å»º  
**ä¸‹ä¸€æ­¥**: åœ¨æœ‰PyTorchçš„çŽ¯å¢ƒä¸­è¿è¡Œè„šæœ¬
